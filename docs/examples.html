<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>OpenAssetIO [beta]: Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="all-content">
<div id="body-content">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenAssetIO [beta]
   </div>
   <div id="projectbrief">An abstract API for generalising interactions between a host application and an asset management system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('examples.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section note"><dt>Note</dt><dd>This section is a work-in-progress. Over time we will add flow diagrams for key operations that happen through the API, along with more extensive sample implementations for both <a class="el" href="glossary.html#host">hosts</a> and <a class="el" href="glossary.html#manager">managers</a>. Currently it is limited to illustrating a few common operations that a host of the API may perform.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>At this stage, until we ship a sample manager implementation, the code for later examples won't actually function.</dd></dl>
<h1><a class="anchor" id="examples_api_initialization"></a>
Initializing the API in a Host</h1>
<p>This example covers the steps required to initialize the API within a <a class="el" href="glossary.html#host">'host'</a> tool, script or application that wishes to interact with an <a class="el" href="glossary.html#asset_management_system">Asset Management System</a>.</p>
<p>It makes use of the <a class="el" href="namespaceopenassetio_1_1plugin_system.html">Plugin System</a> to discover available <a class="el" href="glossary.html#ManagerPlugin">ManagerPlugins</a>.</p>
<p>It also includes a bare-minimum example of a <a class="el" href="classopenassetio_1_1v1_1_1host_api_1_1_host_interface.html">HostInterface</a> implementation.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;from <a class="code" href="namespaceopenassetio_1_1log.html">openassetio.log</a> <span class="keyword">import</span> ConsoleLogger, SeverityFilter</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceopenassetio_1_1host_api.html">openassetio.hostApi</a> <span class="keyword">import</span> HostInterface, Manager, Session</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceopenassetio_1_1plugin_system.html">openassetio.pluginSystem</a> <span class="keyword">import</span> PluginSystemManagerFactory</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">class </span>ExampleHost(HostInterface):</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="stringliteral">    A minimal host implementation.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    @staticmethod</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    <span class="keyword">def </span>identifier():</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;org.openassetio.example.host&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="keyword">def </span>displayName(self):</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;OpenAssetIO Example Host&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"># For simplicity, use a filtered console logger, this logs to</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"># std::out/err based on the value of FOUNDRY_ASSET_LOGGING_SEVERITY.</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"># Practically you may wish to provide a bridge to your own logging</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"># mechanism if you have one.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;logger = SeverityFilter(ConsoleLogger())</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"># We need to provide the mechanism by which managers are created, the</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"># built-in plugin system allows these to be loaded from</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"># FOUNDRY_ASSET_PLUGIN_PATH.</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;factory = PluginSystemManagerFactory(logger)</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"># We then need out implementation of the HostInterface class</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;host_interface = ExampleHost()</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"># We can now start a session with OpenAssetIO. The Session is</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"># the heart of all our interactions with a the API. It allows</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"># us to query the available managers, and pick one to talk to.</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;session = Session(host_interface, logger, factory)</div></div><!-- fragment --><h1><a class="anchor" id="examples_picking_a_manager"></a>
Setting up a Manager</h1>
<p>This example makes use of the newly initialized session to show how to configure a <a class="el" href="glossary.html#session">session</a> to use a specific manager (it assumes that some example <a class="el" href="glossary.html#asset_management_system">Asset Management System</a> has a plugin, installed on <a class="el" href="glossary.html#plugin_path_var">$OPENASSETIO_PLUGIN_PATH</a>).</p>
<p>We will be providing an example manager implementation soon!</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;managers = session.registeredManagers()</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&gt; {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&gt;    <span class="stringliteral">&#39;org.openassetio.example.manager&#39;</span>: {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&gt;         <span class="stringliteral">&#39;name&#39;</span>: <span class="stringliteral">&#39;Example Asset Manager&#39;</span>,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&gt;         <span class="stringliteral">&#39;identifier&#39;</span>: <span class="stringliteral">&#39;org.openassetio.example.manager&#39;</span>,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&gt;         <span class="stringliteral">&#39;info&#39;</span>: {},</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&gt;         <span class="stringliteral">&#39;plugin&#39;</span>: &lt;<span class="keyword">class </span><span class="stringliteral">&#39;5709f502e48331b76857b0f7274cbcf5.ExampleManagerPlugin&#39;</span>&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&gt;    }</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&gt; }</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"># We then tell the session which manager we&#39;d like to use.</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"># Each session can only communicate with one manager at once.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"># If we wanted to bridge between two, we&#39;d create two sessions.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;session.useManager(<span class="stringliteral">&#39;org.openassetio.example.manager&#39;</span>)</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"># At this point the manager hasn&#39;t yet been initialized. This is</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"># done lazily when it&#39;s first needed. This might seem odd here, but</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"># it makes life easier in practice in real-world integrations as often</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"># numerous call sites may wish to obtain access to the manager.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;manager = session.currentManager()</div></div><!-- fragment --><h1><a class="anchor" id="examples_resolving_a_reference"></a>
Resolving a Reference</h1>
<p>This example shows how to use the instantiated manager to resolve a string (<code>some_string</code>) that may be an entity reference to an entity with the 'file' <a class="el" href="glossary.html#trait">Trait</a> - covering use of the correct context and a custom <a class="el" href="glossary.html#locale">locale</a> to describe the call site.</p>
<dl class="section note"><dt>Note</dt><dd>Note how it is the callers responsibility to validate that a string is a <a class="el" href="glossary.html#entity_reference">Entity Reference</a> before passing it to any other OpenAssetIO API that expects one.</dd></dl>
<p>This is to reduce the validation overhead in the manager's implementation of the API. This affords significant gains in real-world production use cases where thousands of references may be operated upon in time-critical scenarios.</p>
<p>The API middleware provides assorted short-circuit validation optimisations that can reduce the number of inter-language hops required. See <a class="el" href="classopenassetio_1_1v1_1_1manager_api_1_1_manager_interface.html#a2a0b607f49506ffe57659036be754260">ManagerInterface.info</a> and the <code>kField_EntityReferencesMatchPrefix</code> key.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> openassetio <span class="keyword">import</span> Context</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> openassetio <span class="keyword">import</span> Specification</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">class </span>APIDocumentationExampleLocale(Specification):</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="stringliteral">     A locale to represent code run as part of a documentation example</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    kTraitSet = {<span class="stringliteral">&quot;documentation&quot;</span>, <span class="stringliteral">&quot;example&quot;</span>}</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"># We must **ALWAYS** validate that a string is an entity reference</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"># before passing it to any other manager API call.</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keywordflow">if</span> <span class="keywordflow">not</span> manager.isEntityReference([some_string])[0]:</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;   <span class="keywordflow">raise</span> ValueError(f<span class="stringliteral">&#39;&quot;{some_string}&quot; isn&#39;</span>t an entity reference.<span class="stringliteral">&#39;)</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="stringliteral"></span><span class="comment"># All calls to the manager must have a Context, these should always</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"># be created by the session, so that state is properly managed.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;context = manager.createContext()</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"># We describe what we want to do with the asset</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;context.access = context.kRead</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"># We tell the manager something about which part of our code is</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"># working with the asset.</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;context.locale = APIDocumentationExampleLocale.create().traitsData()</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"># We describe the lifetime of the returned reference</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"># as persistent retention may require a more stable value.</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;context.retention = context.kTransient</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"># We can now resolve a token we may have if it is a reference. In</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"># this example, we&#39;ll attempt to resolve the asset with the</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"># file trait.</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;[resolved_asset] = manager.resolve([some_string], {FileTrait.id}, context)</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keywordflow">if</span> resolved_asset.hasTrait(FileTrait.id):</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;   path = FileTrait(resolved_asset).getPath()</div></div><!-- fragment --><h1><a class="anchor" id="example_publishing_a_file"></a>
Publishing a File</h1>
<p>This example demonstrates how an API host should involve the manager in the creation of new data. In this case, a simple text file.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> openassetio <span class="keyword">import</span> constants</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> openassetio_mediacreation.specification.entity <span class="keyword">import</span> TextFileSpecification</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"># As ever, an appropriately configured context is required</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;context = manager.createContext()</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;context.access = context.kWrite</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;context.locale = APIDocumentationExampleLocale.create().traitsData()</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"># The first step is to see if the manager wants to manage text files</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;policy = manager.managementPolicy([TextFileSpecification.kTraitSet], context)[0]</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keywordflow">if</span> <span class="keywordflow">not</span> policy &amp; constants.kManaged:</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  <span class="comment"># The manager doesn&#39;t care about this type of asset</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="keywordflow">return</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"># Not all managers can tell us where to put files (irksome).</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"># The reality of handling this is somewhat more challenging, and</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"># depends on the nature of the task in hand. One for further discussion.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;save_path = os.path.join(os.path.expanduser(<span class="stringliteral">&#39;~&#39;</span>), <span class="stringliteral">&#39;greeting.txt&#39;</span>)</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;encoding = <span class="stringliteral">&quot;utf-8&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"># Whenever we make new data, we always tell the manager first,</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"># This allows it to create a placeholder version or similar.</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"># NOTE: It is critical to always use the working_ref from now on.</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;working_ref = manager.preflight([entity_ref], TextFileSpecification.kTraitSet, context)[0]</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"># We then check if the manager can tell us where to save the file.</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keywordflow">if</span> policy &amp; constants.kWillManagePath:</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    working_data = manager.resolve([working_ref], TextFileSpecification.kTraitSet, context)[0]</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    working_spec = TextFileSpecification(working_data)</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    save_path = working_spec.locatableContentTrait().getUrl()</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    encoding_trait = working_spec.textEncodingTrait()</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">if</span> encoding_trait.isValid() <span class="keywordflow">and</span> (custom_encoding := encoding_trait.getEncoding()):</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        encoding = custom_encoding</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"># Now we can write the file</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;with open(save_path, <span class="stringliteral">&#39;w&#39;</span>, encoding=encoding) <span class="keyword">as</span> f:</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;   f.write(<span class="stringliteral">&quot;Hello from the documentation example\n&quot;</span>)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;Prepare the entity specification to register, with the data about</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;where we actually wrote the data to, <span class="keywordflow">and</span> with what encoding.</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;file_spec = TextFileSpecification.create()</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;file_spec.fileTrait().setPath(save_path)</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;file_spec.textEncodingTrait().setEncoding(encoding)</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"># Now the data has been written, we register the file and the publish</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"># is complete. Update the context retention to denote that we&#39;re going</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"># to save a reference to this entity in our user&#39;s history.</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;context.retention = context.kPermanent</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;final_ref = manager.register([working_ref], [file_spec.traitsData()], context)[0]</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"># We can persist this reference as we used the kPermanent retention</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;with open(os.path.join(os.path.expanduser(<span class="stringliteral">&#39;~&#39;</span>), <span class="stringliteral">&#39;history&#39;</span>, <span class="stringliteral">&#39;a&#39;</span>) <span class="keyword">as</span> f:</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    f.write(f<span class="stringliteral">&quot;{final_ref}\n&quot;</span>)</div></div><!-- fragment --><h1><a class="anchor" id="example_generating_a_thumbnail"></a>
Generating a Thumbnail During Publish</h1>
<p>This example demonstrates the correct handling in a <a class="el" href="glossary.html#host">host</a> of the <a class="el" href="namespaceopenassetio_1_1constants.html#aa58867bc9f0e28ae40ae99d5a1c7906a">openassetio.constants.kWantsThumbnail</a> flag if set by a <a class="el" href="glossary.html#manager">manager</a> in its <a class="el" href="classopenassetio_1_1host_api_1_1_manager_1_1_manager.html#ac5587cc282127b7e48e73b6840f04b24">managementPolicy</a> response.</p>
<p>It follows on from the preceding publishing example.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment"># See if the manager wants a thumbnail</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keywordflow">if</span> <span class="keywordflow">not</span> policy &amp; constants.kWantsThumbnail:</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordflow">return</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">from</span> openassetio_mediacreation.specification.entity <span class="keyword">import</span> ThumbnailFileSpecification</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"># Preflight the thumbnail spec&#39;s traits with the target entity&#39;s</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"># reference, this gives us a reference we can now use for all</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"># interactions relating to the thumbnail itself.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;thumbnail_ref = manager.preflight([final_ref], ThumbnailFileSpecification.kTraitSet, context)[0]</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;thumbnail_path = os.path.join(os.path.expanduser(<span class="stringliteral">&#39;~&#39;</span>), <span class="stringliteral">&#39;greeting.preview.png&#39;</span>)</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;thumbnail_attr = {<span class="stringliteral">&quot;width&quot;</span>: 128, <span class="stringliteral">&quot;height&quot;</span>: 128}</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"># See if the manager can tell us where to put it, and what it should be like</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keywordflow">if</span> policy &amp; constants.kWillManagePath:</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    requested = manager.resolve([thumbnail_ref], ThumbnailFileSpecification.kTraitSet, context)[0]</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    requested_spec = ThumbnailFileSpecification(requested)</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    file_trait = requested_spec.fileTrait()</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="keywordflow">if</span> file_trait.isValid() <span class="keywordflow">and</span> (requested_path := file_trait.getPath()):</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        thumbnail_path = requested_path</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    raster_trait = requested_spec.rasterTrait()</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keywordflow">if</span> raster_trait.isValid():</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        thumbnail_attr[<span class="stringliteral">&quot;width&quot;</span>] = raster_trait.getWidth() <span class="keywordflow">or</span> thumbnail_attr[<span class="stringliteral">&quot;width&quot;</span>]</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        thumbnail_attr[<span class="stringliteral">&quot;height&quot;</span>] = raster_trait.getHeight() <span class="keywordflow">or</span> thumbnail_attr[<span class="stringliteral">&quot;height&quot;</span>]</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"># Generate a thumbnail using the supplied criteria</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;mk_thumbnail(thumbnail_path, thumbnail_attr[<span class="stringliteral">&quot;width&quot;</span>], thumbnail_attr[<span class="stringliteral">&quot;height&quot;</span>])</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"># Register the thumbnail to the thumbnail ref (not the entity),</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"># configuring the context to say we&#39;re going to ignore the final ref</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;thumbail_spec = ThumbnailFileSpecification.create()</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;thumbnail_spec.fileTrait().setPath(thumbnail_path)</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;raster_trait = thumbnail_spec.rasterTrait()</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;raster_trait.setWidth(thumbnail_attr[<span class="stringliteral">&quot;width&quot;</span>])</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;raster_trait.setHeight(thumbnail_attr[<span class="stringliteral">&quot;height&quot;</span>])</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;context.retention = context.kTransient</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;manager.register([thumbnail_ref], [thumbnail_spec.traitsData()], context)</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
<hr class="footer"/>
<p id="copyright"><small>Copyright 2013-2021 The Foundry Visionmongers Ltd. OpenAssetIO is released under the <a href="https://www.apache.org/licenses/LICENSE-2.0.txt" target="_blank">Apache 2.0 License</a></small></p>
</div>
</body>
</html>
