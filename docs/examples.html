<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>OpenAssetIO [beta]: Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="all-content">
<div id="body-content">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenAssetIO [beta]
   </div>
   <div id="projectbrief">An abstract API for generalising interactions between a host application and an asset management system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('examples.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section note"><dt>Note</dt><dd>This section is a work-in-progress. Over time we will add flow diagrams for key operations that happen through the API, along with more extensive sample implementations for both <a class="el" href="glossary.html#host">hosts</a> and <a class="el" href="glossary.html#manager">managers</a>. Currently it is limited to illustrating a few common operations that a host of the API may perform.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>At this stage, until we ship a sample manager implementation, the code for later examples won't actually function.</dd></dl>
<h1><a class="anchor" id="examples_api_initialization"></a>
Initializing the API in a Host</h1>
<p>This example covers the steps required to initialize the API within a <a class="el" href="glossary.html#host">'host'</a> tool, script or application that wishes to interact with an <a class="el" href="glossary.html#asset_management_system">Asset Management System</a>.</p>
<p>It makes use of the <a class="el" href="namespaceopenassetio_1_1plugin_system.html">Plugin System</a> to discover available <a class="el" href="glossary.html#PythonPluginSystemManagerPlugin">PythonPluginSystemManagerPlugins</a>.</p>
<p>It also includes a bare-minimum example of a <a class="el" href="classopenassetio_1_1v1_1_1host_api_1_1_host_interface.html">HostInterface</a> implementation.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;from <a class="code" href="namespaceopenassetio_1_1log.html">openassetio.log</a> <span class="keyword">import</span> ConsoleLogger, SeverityFilter</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceopenassetio_1_1host_api.html">openassetio.hostApi</a> <span class="keyword">import</span> HostInterface, Manager, ManagerFactory</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceopenassetio_1_1plugin_system.html">openassetio.pluginSystem</a> <span class="keyword">import</span> PythonPluginSystemManagerImplementationFactory</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">class </span>ExamplesHost(HostInterface):</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="stringliteral">    A minimal host implementation.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    <span class="keyword">def </span>identifier(self):</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;org.openassetio.examples&quot;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    <span class="keyword">def </span>displayName(self):</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;OpenAssetIO Examples&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"># For simplicity, use a filtered console logger, this logs to</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"># stderr based on the value of OPENASSETIO_LOGGING_SEVERITY.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"># Practically you may wish to provide a bridge to your own logging</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"># mechanism if you have one.</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;logger = SeverityFilter(ConsoleLogger())</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"># We need to provide the mechanism by which managers are created, the</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"># built-in plugin system allows these to be loaded from</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"># OPENASSETIO_PLUGIN_PATH.</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;factory_impl = PythonPluginSystemManagerImplementationFactory(logger)</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"># We then need our implementation of the HostInterface class</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;host_interface = ExamplesHost()</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"># We can now create an OpenAssetIO ManagerFactory. The ManagerFactory</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"># allows us to query the available managers, and pick one to talk to.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;managerFactory = ManagerFactory(host_interface, factory_impl, logger)</div></div><!-- fragment --><h1><a class="anchor" id="examples_picking_a_manager"></a>
Setting up a Manager</h1>
<p>This example makes use of the newly initialized factory to show how to construct and configure a specific manager (it assumes that some example <a class="el" href="glossary.html#asset_management_system">Asset Management System</a> has a plugin, installed on <a class="el" href="glossary.html#plugin_path_var">$OPENASSETIO_PLUGIN_PATH</a>).</p>
<p>We will be providing an example manager implementation soon!</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;availableManagers = managerFactory.availableManagers()</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&gt; {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&gt;    <span class="stringliteral">&#39;org.openassetio.example.manager&#39;</span>:</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&gt;         ManagerFactory.ManagerDetail(</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&gt;             identifier=<span class="stringliteral">&#39;org.openassetio.example.manager&#39;</span>,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&gt;             displayName=<span class="stringliteral">&#39;Example Asset Manager&#39;</span>,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&gt;             info={})</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&gt;    }</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&gt; }</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"># Once we know which manager we wish to use, we can ask the factory</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"># to create one for us.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;manager = managerFactory.createManager(<span class="stringliteral">&#39;org.openassetio.example.manager&#39;</span>)</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"># We now have an instance of the requested manager, but it is not</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"># quite ready for use yet. The manager returned by the</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"># ManagerFactory needs to be initialized before it can be used to</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"># query or publish assets. Setup is split into two stages to allow</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"># adjustments to its settings to be made prior to use if required.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"># A manager&#39;s current (or in this case default) settings can be</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"># queried if needed:</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;settings = manager.settings()</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"># ...and updated with new values as desired.</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;settings[<span class="stringliteral">&quot;server&quot;</span>] = <span class="stringliteral">&quot;my.server.com&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"># Finally, we can initialize the manager with the desired settings,</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"># preparing it for use. Note that this may include non-trivial</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"># amounts of work. Settings updates are sparse, so if you don&#39;t have</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"># any custom settings, you can pass an empty dictionary here.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;manager.initialize(settings)</div></div><!-- fragment --><p>To make it easier to deploy a range of OpenAssetIO enabled hosts, the API supports a simple file-based configuration mechanism. Users set the <a class="el" href="glossary.html#default_config_var">$OPENASSETIO_DEFAULT_CONFIG</a> environment variable to point to a suitable TOML file, which contains their preferred manager identifier and settings. As a Host, you can use the <a class="el" href="classopenassetio_1_1v1_1_1host_api_1_1_manager_factory.html#a8b6c44543faebcb1b441bbf63c064c76">defaultManagerForInterface</a> method instead of creating your own ManagerFactory. This will return a fully initialized manager using this configuration if set:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;manager = ManagerFactory.defaultManagerForInterface(</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;             host_interface, impl_factory, logger)</div></div><!-- fragment --><h1><a class="anchor" id="examples_resolving_a_reference"></a>
Resolving a Reference</h1>
<p>This example shows how to use the instantiated manager to resolve a string (<code>some_string</code>) that is assumed to be an entity reference to an entity with the <code>LocatableContent</code> <a class="el" href="glossary.html#trait">Trait</a> (from the MediaCreation package) covering use of the correct context.</p>
<dl class="section note"><dt>Note</dt><dd>The caller must convert a string to an <a class="el" href="classopenassetio_1_1v1_1_1_entity_reference.html">EntityReference</a> object in order to use any OpenAssetIO API that expects an <a class="el" href="glossary.html#entity_reference">Entity Reference</a>. There is more than one approach to this. Below we rely on the exception thrown by <a class="el" href="classopenassetio_1_1v1_1_1host_api_1_1_manager.html#a8a60af0503cefffe5543360ccbcb2d86">createEntityReference</a> when given an invalid reference. Alternatively, we could use <a class="el" href="classopenassetio_1_1v1_1_1host_api_1_1_manager.html#ad5b1862cc47ab4bcb4919def42d4c250">createEntityReferenceIfValid</a> and test if the result is falsey.</dd>
<dd>
Ensuring that an entity reference is valid before handing it to the manager reduces the validation overhead in the manager's implementation of the API. This affords significant gains in real-world production use cases where thousands of references may be operated upon in time-critical scenarios.</dd></dl>
<p>The API middleware provides assorted short-circuit validation optimisations that can reduce the number of inter-language hops required. See <a class="el" href="classopenassetio_1_1v1_1_1manager_api_1_1_manager_interface.html#a2a0b607f49506ffe57659036be754260">ManagerInterface.info</a> and the <code>kField_EntityReferencesMatchPrefix</code> key.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> openassetio <span class="keyword">import</span> Context</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> openassetio_mediacreation.traits.content <span class="keyword">import</span> LocatableContentTrait</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"># Note: this will raise an exception if given a string that is not</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"># recognized by this manager as a valid entity reference (ValueError</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"># in Python, std::domain_error in C++). Consider</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"># createEntityReferenceIfValid, if unsure of the string.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;entity_reference = manager.createEntityReference(some_string)</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"># All calls to the manager must have a Context, these should always</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"># be created by the target manager. The Context expresses the host&#39;s</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"># intent, and ensure that any manager state is properly managed</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"># between API calls.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;context = manager.createContext()</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"># We describe what we want to do with the asset</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;context.access = context.access.kRead</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"># We describe the lifetime of the returned reference</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"># as persistent retention may require a more stable value.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;context.retention = context.retention.kTransient</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"># We can now resolve a token we may have if it is a reference. In</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"># this example, we&#39;ll attempt to resolve the LocatableContent trait</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"># for the entity.</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;resolved_asset = manager.resolve(</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        entity_reference, {LocatableContentTrait.kId}, context)</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;url = LocatableContentTrait(resolved_asset).getLocation()  <span class="comment"># May be None</span></div></div><!-- fragment --><h1><a class="anchor" id="example_discovering_capability"></a>
Discovering capability</h1>
<p>In the previous example, we saw how to resolve a specific trait for an entity. In a real-world scenario, it is important to remember that:</p>
<ul>
<li>Managers may not handle certain types of entity (determined by their <a class="el" href="glossary.html#trait_set">Trait Set</a>).</li>
<li>Managers may not be able to provide data for all traits.</li>
</ul>
<p>The <a class="el" href="classopenassetio_1_1v1_1_1host_api_1_1_manager.html#acdf7d0c3cef98cce7abaf8fb5f004354">managementPolicy</a> method allows a host to query a manager's capabilities and its intentions towards different types of entity.</p>
<p>This method should be used wherever possible to adapt the host's behaviour so that:</p>
<ul>
<li>The manager is not invoked in relation to unsupported entity types.</li>
<li>User workflows are appropriate to the supported capabilities.</li>
</ul>
<p>This example demonstrates how to query a manager in relation to a specific entity type - in this case a simple text file, and inspect its capabilities.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment"># Commented imports are illustrative and may not exist yet</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> openassetio_mediacreation.traits.managementPolicy <span class="keyword">import</span> (</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    ManagedTrait,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">from</span> openassetio_mediacreation.traits.content <span class="keyword">import</span> (</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    LocatableContentTrait, <span class="comment"># TextEncodingTrait</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">from</span> openassetio_mediacreation.specifications.files <span class="keyword">import</span> (</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    <span class="comment"># TextFileSpecification</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;)</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"># Make sure we have the correct context</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;context.access = context.kRead</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"># We use the well-known specification for a text file to determine</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"># the correct trait set to query. Using the standard definition</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"># ensures consistent behaviour across managers/hosts.</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;[policy] = manager.managementPolicy([TextFileSpecification.kTraitSet], context)</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"># We can now check which traits were imbued in the policy, the</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"># absence of a trait means it is unsupported.</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keywordflow">if</span> <span class="keywordflow">not</span> ManagedTrait.isImbuedTo(policy):</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="comment"># The manager doesn&#39;t want to handle text files, we should not</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <span class="comment"># attempt to resolve/publish this type of entity.</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="keywordflow">return</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"># As well as policy-specific traits, the result will be imbued with</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"># traits from the queried trait set that the manager is capable of</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"># providing data for. If you have additional host-specific traits,</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"># you can append these to the ones from the relevant specification.</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"># Here we check for support for the specific text file traits we are</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"># interested in using.</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keywordflow">if</span> LocatableContentTrait.isImbuedTo(policy):</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  print(<span class="stringliteral">&quot;The manager can provide the URL for the file&quot;</span>)</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keywordflow">if</span> TextEncodingTrait.isImbuedTo(policy):</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  print(<span class="stringliteral">&quot;The manager can provide the text encoding used&quot;</span>)</div></div><!-- fragment --><h1><a class="anchor" id="example_publishing_a_file"></a>
Publishing a File</h1>
<p>This example demonstrates how an API host should involve the manager in the creation of new data. In this case, a simple text file.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment"># Commented imports are illustrative and may not exist yet</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> openassetio_mediacreation.traits.managementPolicy <span class="keyword">import</span> (</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    ManagedTrait, ResolvesFutureEntitiesTrait</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">from</span> openassetio_mediacreation.specifications.files <span class="keyword">import</span> (</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    <span class="comment"># TextFileSpecification</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"># As ever, an appropriately configured context is required</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;context = manager.createContext()</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;context.access = context.kWrite</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"># The first step is to see if the manager wants to manage text files</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;policy = manager.managementPolicy([TextFileSpecification.kTraitSet], context)[0]</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keywordflow">if</span> <span class="keywordflow">not</span> ManagedTrait.isImbuedTo(policy):</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  <span class="comment"># The manager doesn&#39;t care about this type of asset</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  <span class="keywordflow">return</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"># Not all managers can tell us where to put files (irksome).</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"># The reality of handling this is somewhat more challenging, and</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"># depends on the nature of the task in hand. One for further discussion.</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;save_path = os.path.join(os.path.expanduser(<span class="stringliteral">&#39;~&#39;</span>), <span class="stringliteral">&#39;greeting.txt&#39;</span>)</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;encoding = <span class="stringliteral">&quot;utf-8&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"># Whenever we make new data, we always tell the manager first,</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"># This allows it to create a placeholder version or similar.</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"># NOTE: It is critical to always use the working_ref from now on.</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;working_ref = manager.preflight(</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        entity_ref, TextFileSpecification.kTraitSet, context)</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"># We then check if the manager can tell us where to save the file.</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keywordflow">if</span> ResolvesFutureEntitiesTrait.isImbuedTo(policy):</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    working_data = manager.resolve(</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;            working_ref, TextFileSpecification.kTraitSet, context)</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    working_spec = TextFileSpecification(working_data)</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordflow">if</span> save_url := working_spec.locatableContentTrait().getLocation():</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        save_path = pathFromURL(save_url)  <span class="comment"># URL decode etc</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">if</span> custom_encoding := working_spec.textEncodingTrait().getEncoding():</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        encoding = custom_encoding</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"># Now we can write the file</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;with open(save_path, <span class="stringliteral">&#39;w&#39;</span>, encoding=encoding) <span class="keyword">as</span> f:</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;   f.write(<span class="stringliteral">&quot;Hello from the documentation example\n&quot;</span>)</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"># Prepare the entity specification to register, with the data about</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"># where we actually wrote the data to, and with what encoding.</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;file_spec = TextFileSpecification.create()</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;file_spec.locatableContentTrait().setLocation(pathToURL(save_path))</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;file_spec.textEncodingTrait().setEncoding(encoding)</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"># Now the data has been written, we register the file and the publish</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"># is complete. Update the context retention to denote that we&#39;re going</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"># to save a reference to this entity in our user&#39;s history.</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;context.retention = context.kPermanent</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;final_ref = manager.register(working_ref, file_spec.traitsData(), context)</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"># We can persist this reference as we used the kPermanent retention</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;with open(os.path.join(os.path.expanduser(<span class="stringliteral">&#39;~&#39;</span>), <span class="stringliteral">&#39;history&#39;</span>, <span class="stringliteral">&#39;a&#39;</span>) <span class="keyword">as</span> f:</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    f.write(f<span class="stringliteral">&quot;{final_ref}\n&quot;</span>)</div></div><!-- fragment --><h1><a class="anchor" id="example_generating_a_thumbnail"></a>
Generating a Thumbnail During Publish</h1>
<p>This example demonstrates the correct handling in a <a class="el" href="glossary.html#host">host</a> of a hypothetical WantsThumbnail trait if set by a <a class="el" href="glossary.html#manager">manager</a> in its <a class="el" href="classopenassetio_1_1v1_1_1host_api_1_1_manager.html#acdf7d0c3cef98cce7abaf8fb5f004354">managementPolicy</a> response.</p>
<p>It follows on from the preceding publishing example.</p>
<dl class="section note"><dt>Note</dt><dd>This example uses imaginary, illustrative traits and specifications that are yet to be finalized.</dd></dl>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment"># See if the manager wants a thumbnail</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keywordflow">if</span> <span class="keywordflow">not</span> WantsThumbnailTrait.isImbuedTo(policy):</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordflow">return</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"># Preflight the thumbnail spec&#39;s traits with the target entity&#39;s</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"># reference, this gives us a reference we can now use for all</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"># interactions relating to the thumbnail itself.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;thumbnail_ref = manager.preflight(</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        final_ref, ThumbnailFileSpecification.kTraitSet, context)</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;thumbnail_path = os.path.join(os.path.expanduser(<span class="stringliteral">&#39;~&#39;</span>), <span class="stringliteral">&#39;greeting.preview.png&#39;</span>)</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;thumbnail_attr = {<span class="stringliteral">&quot;width&quot;</span>: 128, <span class="stringliteral">&quot;height&quot;</span>: 128}</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"># See if the manager can tell us where to put it, and what it should be like</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keywordflow">if</span> ResolvesFutureEntitiesTrait.isImbuedTo(policy):</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    requested = manager.resolve(</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;            thumbnail_ref, ThumbnailFileSpecification.kTraitSet, context)</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    requested_spec = ThumbnailFileSpecification(requested)</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="keywordflow">if</span> requested_path := requested_spec.locatableContentTrait().getLocation():</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        thumbnail_path = pathFromURL(requested_path)</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    raster_trait = requested_spec.rasterTrait()</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keywordflow">if</span> raster_trait.isImbued():</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <span class="comment"># &#39;get&#39; calls can take a default value to avoid exceptions if missing.</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        thumbnail_attr[<span class="stringliteral">&quot;width&quot;</span>] = raster_trait.getWidth(thumbnail_attr[<span class="stringliteral">&quot;width&quot;</span>])</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        thumbnail_attr[<span class="stringliteral">&quot;height&quot;</span>] = raster_trait.getHeight(thumbnail_attr[<span class="stringliteral">&quot;height&quot;</span>])</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"># Generate a thumbnail using the supplied criteria</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;mk_thumbnail(thumbnail_path, thumbnail_attr[<span class="stringliteral">&quot;width&quot;</span>], thumbnail_attr[<span class="stringliteral">&quot;height&quot;</span>])</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"># Register the thumbnail to the thumbnail ref (not the entity),</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"># configuring the context to say we&#39;re going to ignore the final ref</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;thumbail_spec = ThumbnailFileSpecification.create()</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;thumbnail_spec.fileTrait().setPath(thumbnail_path)</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;raster_trait = thumbnail_spec.rasterTrait()</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;raster_trait.setWidth(thumbnail_attr[<span class="stringliteral">&quot;width&quot;</span>])</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;raster_trait.setHeight(thumbnail_attr[<span class="stringliteral">&quot;height&quot;</span>])</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;context.retention = context.kTransient</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;manager.register(thumbnail_ref, thumbnail_spec.traitsData(), context)</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
<hr class="footer"/>
<p id="copyright"><small>Copyright 2013-2023 The Foundry Visionmongers Ltd. OpenAssetIO is released under the <a href="https://www.apache.org/licenses/LICENSE-2.0.txt" target="_blank">Apache 2.0 License</a></small></p>
</div>
</body>
</html>
